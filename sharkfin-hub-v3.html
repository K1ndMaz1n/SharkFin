<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#040810">
  <title>SHARKFIN HUB</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Deep Ocean Palette */
      --abyss: #040810;
      --deep-trench: #061018;
      --midnight-blue: #0a1628;
      --pressure-blue: #0d2137;
      
      /* Bioluminescent Accents */
      --bio-cyan: #4dd8e8;
      --bio-teal: #2ab5a0;
      --bio-glow: #7eecd3;
      --angler-light: #b8f4d8;
      
      /* Warning Colors - muted, pressure-like */
      --blood-deep: #8b3a3a;
      --predator-sense: #c75d5d;
      --caution-amber: #c9a456;
      --treasure-gold: #d4af37;
      
      /* Territory Colors - deeper, more organic */
      --def-deep: #2d7a9c;
      --wl-kelp: #3d9b7a;
      --pur-coral: #b86b4d;
      --inc-sand: #b89b4d;
      --sys-purple: #6b5b8c;
      
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html { height: 100%; overflow: hidden; }
    body {
      font-family: 'Rajdhani', sans-serif;
      background: var(--abyss);
      color: #e0e8f0;
      min-height: 100%;
      height: 100dvh;
      max-width: 430px;
      margin: 0 auto;
      overflow: hidden;
      position: fixed;
      width: 100%;
      left: 50%;
      transform: translateX(-50%);
      overscroll-behavior: none;
      touch-action: pan-x pan-y;
    }
    
    button, .nav-item, .snode, .radar-card {
      -webkit-user-select: none;
      user-select: none;
    }

    /* Deep ocean background with pressure gradient */
    .bg-layer {
      position: fixed; inset: 0;
      background: 
        radial-gradient(ellipse 120% 80% at 50% 0%, rgba(13, 33, 55, 0.4) 0%, transparent 50%),
        radial-gradient(ellipse 100% 60% at 30% 100%, rgba(42, 181, 160, 0.08) 0%, transparent 40%),
        radial-gradient(ellipse 80% 50% at 80% 80%, rgba(77, 216, 232, 0.05) 0%, transparent 35%),
        linear-gradient(180deg, 
          var(--abyss) 0%, 
          var(--deep-trench) 20%,
          var(--midnight-blue) 50%,
          var(--pressure-blue) 75%,
          var(--deep-trench) 90%,
          var(--abyss) 100%
        );
      z-index: 0;
    }
    
    /* Underwater caustic light - disabled for cleaner look */
    /*
    .caustics {
      position: fixed; inset: 0; z-index: 1; pointer-events: none;
      opacity: 0.3;
      background: 
        radial-gradient(ellipse 40% 30% at 20% 30%, rgba(77, 216, 232, 0.15) 0%, transparent 50%),
        radial-gradient(ellipse 35% 25% at 70% 60%, rgba(42, 181, 160, 0.1) 0%, transparent 50%),
        radial-gradient(ellipse 50% 35% at 50% 80%, rgba(126, 236, 211, 0.08) 0%, transparent 50%);
      animation: causticDrift 25s ease-in-out infinite;
    }
    @keyframes causticDrift {
      0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.3; }
      33% { transform: translate(10px, -15px) scale(1.05); opacity: 0.4; }
      66% { transform: translate(-10px, 10px) scale(0.95); opacity: 0.25; }
    }
    */
    
    /* Floating particles - like marine snow */
    .particles { position: fixed; inset: 0; z-index: 1; pointer-events: none; }
    .particle {
      position: absolute;
      background: radial-gradient(circle, rgba(126, 236, 211, 0.6) 0%, transparent 70%);
      border-radius: 50%;
      animation: drift linear infinite;
    }
    .particle:nth-child(1) { width: 3px; height: 3px; left: 10%; animation-duration: 28s; animation-delay: 0s; }
    .particle:nth-child(2) { width: 2px; height: 2px; left: 25%; animation-duration: 32s; animation-delay: -5s; }
    .particle:nth-child(3) { width: 4px; height: 4px; left: 40%; animation-duration: 24s; animation-delay: -10s; }
    .particle:nth-child(4) { width: 2px; height: 2px; left: 60%; animation-duration: 30s; animation-delay: -15s; }
    .particle:nth-child(5) { width: 3px; height: 3px; left: 75%; animation-duration: 26s; animation-delay: -8s; }
    .particle:nth-child(6) { width: 2px; height: 2px; left: 88%; animation-duration: 34s; animation-delay: -20s; }
    @keyframes drift {
      0% { transform: translateY(100vh) translateX(0); opacity: 0; }
      10% { opacity: 0.6; }
      50% { transform: translateY(50vh) translateX(20px); }
      90% { opacity: 0.4; }
      100% { transform: translateY(-10vh) translateX(-10px); opacity: 0; }
    }
    
    /* Depth pressure vignette - disabled, too strong */
    /*
    .pressure-vignette {
      position: fixed; inset: 0; z-index: 2; pointer-events: none;
      background: radial-gradient(ellipse 70% 60% at 50% 50%, transparent 30%, rgba(4, 8, 16, 0.6) 100%);
    }
    */

    .header {
      position: fixed; top: 0; left: 0; right: 0;
      max-width: 430px; margin: 0 auto; 
      height: calc(60px + var(--safe-top));
      padding-top: var(--safe-top);
      background: linear-gradient(180deg, rgba(4, 8, 16, 0.95) 0%, rgba(6, 16, 24, 0.9) 100%);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(77, 216, 232, 0.1);
      display: flex; align-items: center; justify-content: space-between;
      padding-left: max(16px, var(--safe-left));
      padding-right: max(16px, var(--safe-right));
      z-index: 100;
    }
    .user-info { display: flex; align-items: center; gap: 10px; }
    .avatar {
      width: 40px; height: 40px;
      background: linear-gradient(135deg, var(--bio-teal), var(--bio-cyan));
      clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 0 15px rgba(42, 181, 160, 0.3);
    }
    .avatar-inner {
      width: 36px; height: 36px; background: var(--deep-trench);
      clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
      display: flex; align-items: center; justify-content: center;
    }
    .avatar-inner svg { width: 20px; height: 20px; fill: var(--bio-cyan); }
    .rank-text { font-family: 'Orbitron'; font-size: 11px; color: var(--bio-cyan); letter-spacing: 1px; }
    .rank-title { font-size: 12px; color: rgba(224, 232, 240, 0.5); }
    .currency { display: flex; gap: 10px; }
    .currency-item {
      display: flex; align-items: center; gap: 4px;
      padding: 5px 10px; 
      background: linear-gradient(135deg, rgba(42, 181, 160, 0.15), rgba(77, 216, 232, 0.1));
      border: 1px solid rgba(77, 216, 232, 0.2);
      border-radius: 20px;
      font-family: 'Share Tech Mono'; font-size: 13px;
    }
    .currency-item:first-child { color: var(--bio-glow); }
    .currency-item:last-child { color: var(--treasure-gold); background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(201, 164, 86, 0.1)); border-color: rgba(212, 175, 55, 0.2); }

    .page { 
      position: absolute; inset: 0; 
      opacity: 0; visibility: hidden; 
      transition: opacity 0.4s, visibility 0.4s;
      z-index: 10;
    }
    .page.active { opacity: 1; visibility: visible; }

    /* HOME PAGE */
    .home-page {
      padding: calc(70px + var(--safe-top)) 16px calc(80px + var(--safe-bottom));
      padding-left: max(16px, var(--safe-left));
      padding-right: max(16px, var(--safe-right));
      height: 100%; overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    .home-page::-webkit-scrollbar { width: 2px; }
    .home-page::-webkit-scrollbar-thumb { background: var(--bio-teal); }

    .threat-card {
      background: linear-gradient(165deg, rgba(13, 33, 55, 0.8), rgba(6, 16, 24, 0.9));
      border: 1px solid rgba(77, 216, 232, 0.15);
      border-radius: 16px;
      padding: 20px; margin-bottom: 20px;
      position: relative; overflow: hidden;
    }
    .threat-card::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
      background: linear-gradient(90deg, var(--bio-teal), var(--bio-cyan), var(--bio-glow));
      opacity: 0.8;
    }
    .threat-card::after {
      content: ''; position: absolute; inset: 0;
      background: radial-gradient(ellipse 80% 60% at 80% 20%, rgba(77, 216, 232, 0.08) 0%, transparent 50%);
      pointer-events: none;
    }
    .threat-label {
      font-family: 'Orbitron'; font-size: 10px; color: var(--predator-sense);
      letter-spacing: 2px; margin-bottom: 8px;
      animation: subtlePulse 4s ease-in-out infinite;
    }
    @keyframes subtlePulse {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; }
    }
    .threat-title {
      font-family: 'Orbitron'; font-size: 20px; font-weight: 800;
      background: linear-gradient(135deg, var(--bio-glow), #fff, var(--bio-cyan));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      margin-bottom: 10px; line-height: 1.2;
    }
    .threat-desc { font-size: 13px; color: rgba(224, 232, 240, 0.6); margin-bottom: 14px; line-height: 1.5; }
    .threat-meta { display: flex; gap: 12px; margin-bottom: 16px; align-items: center; }
    .reward { font-family: 'Share Tech Mono'; font-size: 16px; color: var(--treasure-gold); }
    .diff-tag {
      font-family: 'Orbitron'; font-size: 9px; padding: 4px 12px;
      background: rgba(139, 58, 58, 0.2); color: var(--predator-sense);
      letter-spacing: 1px;
      border-radius: 12px;
      border: 1px solid rgba(199, 93, 93, 0.3);
    }
    .time-tag { font-size: 11px; color: var(--bio-cyan); display: flex; align-items: center; gap: 4px; }
    .time-tag svg { width: 12px; height: 12px; fill: var(--bio-cyan); }
    .cta-btn {
      width: 100%; padding: 16px;
      background: linear-gradient(135deg, var(--bio-teal), var(--bio-cyan));
      border: none; color: var(--abyss);
      font-family: 'Orbitron'; font-size: 13px; font-weight: 700;
      letter-spacing: 2px; cursor: pointer;
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center; gap: 8px;
      min-height: 50px;
      -webkit-tap-highlight-color: transparent;
      box-shadow: 0 4px 20px rgba(42, 181, 160, 0.3);
      transition: transform 0.2s, box-shadow 0.2s;
      position: relative;
      z-index: 1;
    }
    .cta-btn:hover { box-shadow: 0 6px 25px rgba(42, 181, 160, 0.4); }
    .cta-btn:active { transform: scale(0.98); }
    .cta-btn svg { width: 16px; height: 16px; fill: var(--abyss); }

    .section-label {
      font-family: 'Orbitron'; font-size: 11px; color: var(--bio-cyan);
      letter-spacing: 2px; margin-bottom: 12px;
      display: flex; align-items: center; gap: 10px;
      opacity: 0.8;
    }
    .section-label::after {
      content: ''; flex: 1; height: 1px;
      background: linear-gradient(90deg, rgba(77, 216, 232, 0.4), transparent);
    }
    .radar-card {
      background: linear-gradient(165deg, rgba(13, 33, 55, 0.6), rgba(6, 16, 24, 0.7));
      border: 1px solid rgba(77, 216, 232, 0.12);
      border-radius: 16px;
      padding: 20px; margin-bottom: 20px;
      cursor: pointer; transition: transform 0.3s, box-shadow 0.3s;
    }
    .radar-card:hover { transform: scale(1.02); box-shadow: 0 0 30px rgba(42, 181, 160, 0.15); }
    .radar-wrap { width: 180px; height: 180px; margin: 0 auto 12px; position: relative; }
    .radar-svg { width: 100%; height: 100%; }
    .radar-ring { fill: none; stroke: rgba(77, 216, 232, 0.12); }
    .radar-shape { fill: rgba(42, 181, 160, 0.15); stroke: var(--bio-teal); stroke-width: 2; }
    .radar-dot { fill: var(--bio-cyan); }
    .radar-lbl { font-family: 'Orbitron'; font-size: 8px; fill: rgba(224, 232, 240, 0.5); }
    .radar-center {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      width: 32px; height: 32px;
    }
    .radar-center svg { width: 100%; height: 100%; fill: var(--bio-cyan); animation: gentlePulse 3s ease-in-out infinite; }
    @keyframes gentlePulse {
      0%, 100% { opacity: 0.7; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.05); }
    }
    
    /* Locked radar overlay */
    .radar-locked {
      position: relative;
    }
    .radar-locked .radar-wrap,
    .radar-locked .skill-tags {
      filter: blur(6px);
      opacity: 0.4;
      pointer-events: none;
    }
    .radar-locked .tap-hint,
    .radar-locked .outline-btn {
      display: none;
    }
    .radar-lock-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 10;
    }
    .radar-lock-icon {
      width: 52px; height: 52px;
      margin: 0 auto 12px;
      background: radial-gradient(circle, rgba(42, 181, 160, 0.15) 0%, transparent 70%);
      border: 2px solid rgba(77, 216, 232, 0.4);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 20px;
      box-shadow: 0 0 20px rgba(42, 181, 160, 0.2);
    }
    .radar-lock-title {
      font-family: 'Orbitron';
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 1px;
      color: var(--bio-cyan);
      margin-bottom: 4px;
    }
    .radar-lock-desc {
      font-size: 12px;
      color: rgba(224, 232, 240, 0.5);
      max-width: 180px;
    }
    .radar-lock-level {
      margin-top: 12px;
      font-family: 'Share Tech Mono';
      font-size: 11px;
      color: rgba(224, 232, 240, 0.4);
    }
    .radar-lock-level span {
      color: var(--treasure-gold);
      font-weight: 600;
    }
    .tap-hint {
      text-align: center; font-family: 'Orbitron'; font-size: 9px;
      color: rgba(224, 232, 240, 0.35); letter-spacing: 2px; margin-bottom: 12px;
    }
    .skill-tags { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px; justify-content: center; }
    .skill-tag {
      font-size: 10px; padding: 4px 12px;
      background: rgba(42, 181, 160, 0.12); color: var(--bio-glow);
      border-radius: 12px;
      border: 1px solid rgba(77, 216, 232, 0.15);
    }
    .skill-tag::before { content: 'â—ˆ '; opacity: 0.6; }
    .outline-btn {
      width: 100%; padding: 12px;
      background: transparent; 
      border: 1px solid rgba(77, 216, 232, 0.4);
      color: var(--bio-cyan);
      font-family: 'Orbitron'; font-size: 10px; letter-spacing: 2px;
      cursor: pointer; transition: all 0.3s;
      display: flex; align-items: center; justify-content: center; gap: 6px;
      min-height: 48px;
      border-radius: 10px;
    }
    .outline-btn:hover, .outline-btn:active { 
      background: linear-gradient(135deg, var(--bio-teal), var(--bio-cyan)); 
      color: var(--abyss); 
      border-color: transparent;
    }
    .outline-btn svg { width: 12px; height: 12px; fill: currentColor; }

    /* MISSION BOARD */
    .mission-board { margin-bottom: 20px; }
    .board-section { margin-bottom: 16px; }
    .board-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 10px;
    }
    .board-title {
      font-family: 'Orbitron'; font-size: 11px; font-weight: 600;
      letter-spacing: 1.5px; color: rgba(224, 232, 240, 0.5);
    }
    .board-timer {
      font-family: 'Share Tech Mono'; font-size: 11px;
      color: var(--bio-cyan);
      display: flex; align-items: center; gap: 4px;
    }
    .board-timer svg { width: 12px; height: 12px; fill: currentColor; }
    
    .challenge-card {
      background: linear-gradient(165deg, rgba(13, 33, 55, 0.5), rgba(6, 16, 24, 0.6));
      border: 1px solid rgba(77, 216, 232, 0.1);
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 8px;
      display: flex; align-items: center; gap: 12px;
      transition: all 0.3s;
      cursor: pointer;
    }
    .challenge-card:active { transform: scale(0.98); background: rgba(42, 181, 160, 0.1); }
    .challenge-card.completed { opacity: 0.5; }
    .challenge-card.completed .challenge-check { 
      background: var(--bio-teal); 
      border-color: var(--bio-teal);
      box-shadow: 0 0 10px rgba(42, 181, 160, 0.4);
    }
    .challenge-card.completed .challenge-check::after {
      content: 'âœ“'; color: var(--abyss); font-size: 10px; font-weight: 700;
    }
    
    .challenge-check {
      width: 22px; height: 22px; flex-shrink: 0;
      border: 2px solid rgba(224, 232, 240, 0.25);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.3s;
    }
    
    .challenge-content { flex: 1; min-width: 0; }
    .challenge-title {
      font-size: 14px; font-weight: 600;
      margin-bottom: 2px;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
      color: rgba(224, 232, 240, 0.9);
    }
    .challenge-card.completed .challenge-title { text-decoration: line-through; }
    .challenge-desc {
      font-size: 11px; color: rgba(224, 232, 240, 0.4);
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    
    .challenge-reward {
      display: flex; flex-direction: column; align-items: flex-end; gap: 2px;
      flex-shrink: 0;
    }
    .reward-xp {
      font-family: 'Share Tech Mono'; font-size: 13px; font-weight: 700;
      color: var(--treasure-gold);
    }
    .reward-type {
      font-size: 9px; font-weight: 600; letter-spacing: 0.5px;
      padding: 3px 8px; border-radius: 8px;
    }
    .reward-type.quiz { background: rgba(45, 122, 156, 0.25); color: var(--def-deep); }
    .reward-type.scenario { background: rgba(199, 93, 93, 0.2); color: var(--predator-sense); }
    .reward-type.lesson { background: rgba(107, 91, 140, 0.25); color: var(--sys-purple); }
    .reward-type.real { background: rgba(61, 155, 122, 0.25); color: var(--wl-kelp); }
    
    .weekly-card {
      background: linear-gradient(165deg, rgba(212, 175, 55, 0.08), rgba(184, 155, 77, 0.05));
      border: 1px solid rgba(212, 175, 55, 0.2);
      border-radius: 14px;
      padding: 16px;
      position: relative;
      overflow: hidden;
    }
    .weekly-card::before {
      content: '';
      position: absolute;
      top: 0; right: 0;
      width: 150px; height: 150px;
      background: radial-gradient(circle, rgba(212, 175, 55, 0.1) 0%, transparent 60%);
      pointer-events: none;
    }
    .weekly-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 10px;
    }
    .weekly-title {
      font-size: 15px; font-weight: 700;
      color: var(--treasure-gold);
    }
    .weekly-reward {
      font-family: 'Share Tech Mono'; font-size: 14px; font-weight: 700;
      color: var(--treasure-gold);
      display: flex; align-items: center; gap: 4px;
    }
    .weekly-progress {
      height: 6px; background: rgba(224, 232, 240, 0.08);
      border-radius: 3px; overflow: hidden;
      margin-bottom: 8px;
    }
    .weekly-progress-fill {
      height: 100%; background: linear-gradient(90deg, var(--treasure-gold), var(--caution-amber));
      border-radius: 3px;
      transition: width 0.3s;
    }
    .weekly-status {
      font-size: 11px; color: rgba(224, 232, 240, 0.5);
    }
    .weekly-status span { color: var(--treasure-gold); font-weight: 600; }

    /* INTEL PAGE */
    .intel-page { height: 100%; display: flex; flex-direction: column; }
    .intel-header {
      position: fixed; top: calc(60px + var(--safe-top)); left: 0; right: 0;
      max-width: 430px; margin: 0 auto; height: 45px;
      background: linear-gradient(180deg, rgba(4, 8, 16, 0.95), rgba(6, 16, 24, 0.9));
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 max(16px, var(--safe-left));
      padding-right: max(16px, var(--safe-right));
      z-index: 90;
      border-bottom: 1px solid rgba(77, 216, 232, 0.08);
    }
    .back-btn {
      display: flex; align-items: center; gap: 6px;
      background: none; border: none; color: var(--bio-cyan);
      font-family: 'Rajdhani'; font-size: 14px; font-weight: 600; cursor: pointer;
      padding: 8px; margin: -8px;
      min-height: 44px; min-width: 44px;
    }
    .back-btn svg { width: 16px; height: 16px; fill: var(--bio-cyan); }
    .intel-title { font-family: 'Orbitron'; font-size: 12px; letter-spacing: 2px; color: rgba(224, 232, 240, 0.7); }
    .heat-btn {
      display: flex; align-items: center; gap: 4px;
      background: rgba(199, 93, 93, 0.15); border: 1px solid rgba(199, 93, 93, 0.4);
      color: var(--predator-sense);
      font-family: 'Orbitron'; font-size: 9px;
      padding: 8px 12px; cursor: pointer; transition: all 0.3s;
      min-height: 44px;
    }
    .heat-btn.on { background: var(--predator-magenta); color: #fff; }
    .heat-btn svg { width: 10px; height: 10px; fill: currentColor; }
    
    .zoom-controls {
      display: flex; gap: 8px; align-items: center;
    }
    .zoom-btn {
      width: 36px; height: 36px;
      background: rgba(0, 230, 255, 0.1);
      border: 1px solid var(--neon-cyan);
      color: var(--neon-cyan);
      font-size: 18px; font-weight: bold;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; transition: all 0.2s;
      min-height: 44px; min-width: 44px;
    }
    .zoom-btn:active { background: var(--neon-cyan); color: var(--abyss); }
    .zoom-level {
      font-family: 'Share Tech Mono'; font-size: 11px;
      color: rgba(255,255,255,0.5); min-width: 35px; text-align: center;
    }

    .grid-area {
      flex: 1; 
      margin-top: calc(105px + var(--safe-top)); 
      margin-bottom: calc(70px + var(--safe-bottom));
      overflow: hidden; position: relative;
    }
    .grid-scroll {
      width: 100%; height: 100%;
      overflow: auto; cursor: grab;
      -webkit-overflow-scrolling: touch;
    }
    .zoom-container {
      transform-origin: 0 0;
      transition: transform 0.1s ease-out;
    }
    .grid-scroll::-webkit-scrollbar { display: none; }
    
    /* Zoom controls */
    .zoom-controls {
      position: absolute; bottom: 16px; right: max(16px, var(--safe-right));
      display: flex; flex-direction: column; gap: 8px; z-index: 50;
    }
    .zoom-btn {
      width: 44px; height: 44px;
      background: rgba(7, 20, 36, 0.9);
      border: 1px solid rgba(0, 230, 255, 0.3);
      border-radius: 8px;
      color: var(--neon-cyan);
      font-size: 20px; font-weight: bold;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s;
    }
    .zoom-btn:active { background: var(--neon-cyan); color: var(--abyss); }
    .zoom-level {
      text-align: center;
      font-family: 'Share Tech Mono'; font-size: 10px;
      color: rgba(255,255,255,0.5);
    }
    
    /* THE MAP - using absolute positioning for everything */
    .skill-map {
      width: 800px; height: 900px; 
      position: relative;
      background: radial-gradient(circle at 400px 450px, rgba(0, 230, 255, 0.05) 0%, transparent 40%);
    }
    .map-grid {
      position: absolute; inset: 0;
      background-image: linear-gradient(rgba(0,230,255,0.02) 1px, transparent 1px),
                        linear-gradient(90deg, rgba(0,230,255,0.02) 1px, transparent 1px);
      background-size: 40px 40px;
    }

    /* UNDERWATER BACKGROUND ELEMENTS */
    .underwater-bg {
      position: absolute; inset: 0; pointer-events: none; overflow: hidden;
    }
    
    /* Sunken Temple Ruins */
    .ruin {
      position: absolute;
      opacity: 0.15;
      filter: blur(1px);
    }
    .ruin-1 {
      top: 50px; left: 30px;
      width: 180px; height: 200px;
      background: linear-gradient(180deg, transparent 0%, rgba(0,230,255,0.1) 100%);
      clip-path: polygon(20% 100%, 25% 60%, 10% 60%, 10% 40%, 30% 40%, 30% 20%, 40% 20%, 40% 0%, 60% 0%, 60% 20%, 70% 20%, 70% 40%, 90% 40%, 90% 60%, 75% 60%, 80% 100%);
    }
    .ruin-2 {
      top: 600px; right: 20px;
      width: 150px; height: 180px;
      background: linear-gradient(180deg, transparent 0%, rgba(0,230,255,0.08) 100%);
      clip-path: polygon(0% 100%, 5% 50%, 20% 50%, 20% 30%, 35% 30%, 35% 10%, 50% 0%, 65% 10%, 65% 30%, 80% 30%, 80% 50%, 95% 50%, 100% 100%);
    }
    .ruin-3 {
      bottom: 100px; left: 50%;
      transform: translateX(-50%);
      width: 250px; height: 120px;
      background: linear-gradient(180deg, transparent 0%, rgba(170,85,255,0.1) 100%);
      clip-path: polygon(0% 100%, 10% 70%, 10% 50%, 25% 50%, 25% 30%, 40% 30%, 45% 0%, 55% 0%, 60% 30%, 75% 30%, 75% 50%, 90% 50%, 90% 70%, 100% 100%);
    }

    /* Coral/Rock formations */
    .coral {
      position: absolute;
      opacity: 0.12;
    }
    .coral-1 {
      top: 300px; left: 10px;
      width: 60px; height: 100px;
      background: linear-gradient(0deg, rgba(255,0,127,0.3), transparent);
      clip-path: polygon(50% 0%, 70% 30%, 90% 20%, 80% 50%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 20% 50%, 10% 20%, 30% 30%);
    }
    .coral-2 {
      top: 200px; right: 15px;
      width: 50px; height: 80px;
      background: linear-gradient(0deg, rgba(0,255,136,0.3), transparent);
      clip-path: polygon(50% 0%, 80% 20%, 100% 50%, 80% 80%, 90% 100%, 10% 100%, 20% 80%, 0% 50%, 20% 20%);
    }
    .coral-3 {
      bottom: 200px; right: 300px;
      width: 40px; height: 70px;
      background: linear-gradient(0deg, rgba(255,170,0,0.3), transparent);
      clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 80% 60%, 100% 100%, 0% 100%, 20% 60%, 0% 30%);
    }

    /* Treasure chests near locked areas */
    .treasure {
      position: absolute;
      font-size: 24px;
      opacity: 0.3;
      filter: drop-shadow(0 0 10px rgba(255,215,0,0.3));
      animation: treasureGlow 3s ease-in-out infinite;
    }
    @keyframes treasureGlow {
      0%, 100% { opacity: 0.2; transform: scale(1); }
      50% { opacity: 0.4; transform: scale(1.1); }
    }
    .treasure-1 { top: 320px; left: 280px; }
    .treasure-2 { top: 750px; right: 200px; }
    .treasure-3 { bottom: 50px; left: 250px; }

    /* Rising bubbles */
    .bubbles {
      position: absolute; inset: 0; pointer-events: none;
    }
    .bubble {
      position: absolute;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.4), rgba(0,230,255,0.1));
      animation: bubbleRise linear infinite;
    }
    .bubble:nth-child(1) { width: 8px; height: 8px; left: 10%; animation-duration: 12s; animation-delay: 0s; }
    .bubble:nth-child(2) { width: 5px; height: 5px; left: 25%; animation-duration: 15s; animation-delay: -3s; }
    .bubble:nth-child(3) { width: 12px; height: 12px; left: 40%; animation-duration: 18s; animation-delay: -6s; }
    .bubble:nth-child(4) { width: 6px; height: 6px; left: 55%; animation-duration: 14s; animation-delay: -2s; }
    .bubble:nth-child(5) { width: 10px; height: 10px; left: 70%; animation-duration: 16s; animation-delay: -8s; }
    .bubble:nth-child(6) { width: 4px; height: 4px; left: 85%; animation-duration: 13s; animation-delay: -4s; }
    .bubble:nth-child(7) { width: 7px; height: 7px; left: 15%; animation-duration: 17s; animation-delay: -10s; }
    .bubble:nth-child(8) { width: 9px; height: 9px; left: 60%; animation-duration: 14s; animation-delay: -5s; }
    .bubble:nth-child(9) { width: 5px; height: 5px; left: 80%; animation-duration: 19s; animation-delay: -7s; }
    .bubble:nth-child(10) { width: 11px; height: 11px; left: 35%; animation-duration: 15s; animation-delay: -1s; }
    @keyframes bubbleRise {
      0% { bottom: -20px; opacity: 0; transform: translateX(0); }
      10% { opacity: 0.6; }
      90% { opacity: 0.6; }
      100% { bottom: 100%; opacity: 0; transform: translateX(20px); }
    }

    /* Bioluminescent plants */
    .glow-plant {
      position: absolute;
      opacity: 0.25;
      animation: plantPulse 4s ease-in-out infinite;
    }
    @keyframes plantPulse {
      0%, 100% { opacity: 0.15; filter: blur(2px); }
      50% { opacity: 0.35; filter: blur(1px); }
    }
    .glow-plant-1 {
      bottom: 150px; left: 50px;
      width: 30px; height: 60px;
      background: linear-gradient(0deg, rgba(0,255,136,0.5), transparent);
      clip-path: polygon(50% 0%, 70% 40%, 60% 100%, 40% 100%, 30% 40%);
    }
    .glow-plant-2 {
      bottom: 180px; left: 70px;
      width: 20px; height: 45px;
      background: linear-gradient(0deg, rgba(0,230,255,0.5), transparent);
      clip-path: polygon(50% 0%, 80% 50%, 60% 100%, 40% 100%, 20% 50%);
      animation-delay: -1s;
    }
    .glow-plant-3 {
      top: 350px; right: 40px;
      width: 25px; height: 50px;
      background: linear-gradient(0deg, rgba(255,0,127,0.4), transparent);
      clip-path: polygon(50% 0%, 75% 35%, 65% 100%, 35% 100%, 25% 35%);
      animation-delay: -2s;
    }

    /* CONNECTION LINES SVG */
    .connection-lines {
      position: absolute; inset: 0; pointer-events: none; z-index: 1;
    }
    .conn-line {
      fill: none;
      stroke-width: 2;
      stroke-linecap: round;
    }
    .conn-def { stroke: rgba(0,168,255,0.3); }
    .conn-wl { stroke: rgba(0,255,136,0.3); }
    .conn-inc { stroke: rgba(255,170,0,0.3); }
    .conn-pur { stroke: rgba(255,107,53,0.3); }
    .conn-sys { stroke: rgba(170,85,255,0.3); }
    
    /* Animated pulse traveling along lines */
    .conn-pulse {
      stroke-width: 3;
      stroke-dasharray: 8 40;
      animation: pulseLine 3s linear infinite;
    }
    .conn-pulse.conn-def { stroke: rgba(0,168,255,0.7); }
    .conn-pulse.conn-wl { stroke: rgba(0,255,136,0.7); }
    .conn-pulse.conn-inc { stroke: rgba(255,170,0,0.7); }
    .conn-pulse.conn-pur { stroke: rgba(255,107,53,0.7); }
    .conn-pulse.conn-sys { stroke: rgba(170,85,255,0.7); }
    @keyframes pulseLine {
      0% { stroke-dashoffset: 48; }
      100% { stroke-dashoffset: 0; }
    }

    /* Caustic light overlay */
    .caustics-overlay {
      position: absolute; inset: 0; pointer-events: none;
      background: 
        radial-gradient(ellipse 80% 50% at 20% 20%, rgba(0,230,255,0.03) 0%, transparent 50%),
        radial-gradient(ellipse 60% 40% at 70% 60%, rgba(0,255,136,0.02) 0%, transparent 50%),
        radial-gradient(ellipse 70% 50% at 50% 80%, rgba(170,85,255,0.02) 0%, transparent 50%);
      animation: causticShift 20s ease-in-out infinite;
    }
    @keyframes causticShift {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    /* Center emblem - FIXED position within the map */
    .map-center {
      position: absolute; 
      top: 450px; left: 400px; 
      transform: translate(-50%, -50%);
      width: 80px; height: 80px;
      z-index: 10;
    }
    .center-ring {
      width: 100%; height: 100%;
      border: 2px solid var(--neon-cyan); border-radius: 50%;
      background: rgba(0, 230, 255, 0.1);
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 0 40px rgba(0, 230, 255, 0.4);
      animation: centerPulse 3s infinite;
    }
    @keyframes centerPulse {
      0%, 100% { box-shadow: 0 0 30px rgba(0, 230, 255, 0.3); }
      50% { box-shadow: 0 0 50px rgba(0, 230, 255, 0.6); }
    }
    .center-ring svg { width: 36px; height: 36px; fill: var(--neon-cyan); }

    /* Territory labels */
    .terr-label {
      position: absolute;
      font-family: 'Orbitron'; font-size: 10px; font-weight: 700;
      letter-spacing: 2px; padding: 5px 12px;
      z-index: 5;
    }
    .terr-bar {
      position: absolute; height: 4px; width: 120px;
      background: rgba(255,255,255,0.1); border-radius: 2px;
    }
    .terr-fill { height: 100%; border-radius: 2px; }

    /* DEFENSE - top left */
    .lbl-def { top: 100px; left: 100px; background: rgba(0,168,255,0.25); color: var(--def-blue); border: 1px solid var(--def-blue); }
    .bar-def { top: 135px; left: 100px; }
    .bar-def .terr-fill { background: var(--def-blue); width: 60%; }

    /* WEALTH - top right */
    .lbl-wl { top: 100px; right: 100px; background: rgba(0,255,136,0.25); color: var(--wl-green); border: 1px solid var(--wl-green); }
    .bar-wl { top: 135px; right: 100px; }
    .bar-wl .terr-fill { background: var(--wl-green); width: 40%; }

    /* INCOME - bottom left */
    .lbl-inc { top: 550px; left: 80px; background: rgba(255,170,0,0.25); color: var(--inc-amber); border: 1px solid var(--inc-amber); }
    .bar-inc { top: 585px; left: 80px; }
    .bar-inc .terr-fill { background: var(--inc-amber); width: 35%; }

    /* PURCHASE - bottom right */
    .lbl-pur { top: 550px; right: 80px; background: rgba(255,107,53,0.25); color: var(--pur-orange); border: 1px solid var(--pur-orange); }
    .bar-pur { top: 585px; right: 80px; }
    .bar-pur .terr-fill { background: var(--pur-orange); width: 25%; }

    /* SYSTEMS - bottom center */
    .lbl-sys { top: 750px; left: 50%; transform: translateX(-50%); background: rgba(170,85,255,0.25); color: var(--sys-violet); border: 1px solid var(--sys-violet); }
    .bar-sys { top: 785px; left: 50%; transform: translateX(-50%); }
    .bar-sys .terr-fill { background: var(--sys-violet); width: 15%; }

    /* Skill nodes - all absolute positioned */
    .snode {
      position: absolute; width: 54px; height: 54px;
      cursor: pointer; transition: transform 0.2s;
      z-index: 20;
      /* Ensure minimum touch target */
      min-width: 44px; min-height: 44px;
    }
    .snode:hover, .snode:active { transform: scale(1.15); z-index: 30; }
    .snode-shape {
      width: 100%; height: 100%;
      clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
      display: flex; align-items: center; justify-content: center;
      font-size: 20px;
    }
    .snode.locked .snode-shape { background: rgba(30,30,50,0.9); border: 2px solid rgba(255,58,58,0.5); }
    .snode.unlocked .snode-shape { background: rgba(0,230,255,0.2); border: 2px solid var(--neon-cyan); box-shadow: 0 0 15px rgba(0,230,255,0.5); }
    .snode.mastered .snode-shape { background: rgba(255,215,0,0.25); border: 2px solid var(--sharp-gold); box-shadow: 0 0 18px rgba(255,215,0,0.5); }
    .snode.recommended .snode-shape { background: rgba(255,255,255,0.25); border: 3px solid #fff; box-shadow: 0 0 22px rgba(255,255,255,0.6); }
    .snode.recommended::after {
      content: 'â–¼'; position: absolute; top: -18px; left: 50%;
      transform: translateX(-50%); color: #fff; font-size: 12px;
      animation: arrBounce 0.8s infinite;
    }
    @keyframes arrBounce { 0%, 100% { transform: translateX(-50%) translateY(0); } 50% { transform: translateX(-50%) translateY(4px); } }

    /* Heatmap mode */
    .grid-area.heatmap .snode.locked .snode-shape,
    .grid-area.heatmap .snode.recommended .snode-shape {
      background: rgba(255,58,58,0.4) !important; border-color: var(--warning-red) !important;
      box-shadow: 0 0 20px rgba(255,58,58,0.6) !important;
    }
    .grid-area.heatmap .snode.unlocked .snode-shape {
      background: rgba(255,170,0,0.4) !important; border-color: var(--inc-amber) !important;
    }
    .grid-area.heatmap .snode.mastered .snode-shape {
      background: rgba(0,255,136,0.4) !important; border-color: var(--wl-green) !important;
    }

    /* Detail panel */
    .detail-panel {
      position: fixed; 
      bottom: calc(70px + var(--safe-bottom)); 
      left: 0; right: 0;
      max-width: 430px; margin: 0 auto;
      background: linear-gradient(180deg, rgba(13, 33, 55, 0.98), var(--abyss));
      border-top: 2px solid var(--bio-teal);
      border-radius: 20px 20px 0 0;
      padding: 16px;
      padding-left: max(16px, var(--safe-left));
      padding-right: max(16px, var(--safe-right));
      z-index: 200;
      transform: translateY(100%);
      transition: transform 0.35s cubic-bezier(0.16, 1, 0.3, 1);
      max-height: 50vh;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    .detail-panel.open { transform: translateY(0); }
    .panel-x {
      position: absolute; top: 10px; right: 10px;
      width: 28px; height: 28px;
      background: rgba(224, 232, 240, 0.08); border: none; border-radius: 50%;
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      transition: background 0.2s;
    }
    .panel-x:active { background: rgba(224, 232, 240, 0.15); }
    .panel-x svg { width: 12px; height: 12px; fill: rgba(224, 232, 240, 0.6); }
    .detail-top { display: flex; gap: 12px; margin-bottom: 12px; }
    .detail-icon {
      width: 50px; height: 50px;
      background: radial-gradient(circle, rgba(42, 181, 160, 0.2) 0%, transparent 70%);
      border: 2px solid var(--bio-teal);
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-size: 22px;
    }
    .detail-name { font-family: 'Orbitron'; font-size: 14px; font-weight: 700; color: rgba(224, 232, 240, 0.95); }
    .detail-tier { font-family: 'Share Tech Mono'; font-size: 9px; color: var(--bio-cyan); margin-top: 4px; }
    .threat-box {
      background: rgba(139, 58, 58, 0.12); 
      border: 1px solid rgba(199, 93, 93, 0.3);
      border-radius: 10px;
      padding: 10px; margin-bottom: 12px;
    }
    .threat-lbl { font-family: 'Orbitron'; font-size: 7px; color: var(--predator-sense); letter-spacing: 1px; margin-bottom: 4px; }
    .threat-nm { font-size: 12px; font-weight: 600; color: rgba(224, 232, 240, 0.9); }
    .threat-qt { font-size: 10px; color: rgba(224, 232, 240, 0.5); font-style: italic; margin-top: 3px; }
    .steps-box { margin-bottom: 12px; }
    .steps-lbl { font-family: 'Orbitron'; font-size: 8px; color: var(--bio-cyan); letter-spacing: 1px; margin-bottom: 10px; opacity: 0.8; }
    .step { display: flex; gap: 10px; padding: 8px 0; border-bottom: 1px solid rgba(224, 232, 240, 0.05); }
    .step-n {
      width: 22px; height: 22px;
      background: rgba(42, 181, 160, 0.15); border: 1px solid rgba(77, 216, 232, 0.4); border-radius: 50%;
      font-family: 'Orbitron'; font-size: 8px; color: var(--bio-cyan);
      display: flex; align-items: center; justify-content: center;
    }
    .step.done .step-n { background: var(--treasure-gold); border-color: var(--treasure-gold); color: var(--abyss); }
    .step-t { font-size: 11px; font-weight: 600; color: rgba(224, 232, 240, 0.85); }
    .step-d { font-size: 9px; color: rgba(224, 232, 240, 0.45); }
    .reward-box {
      display: flex; justify-content: space-between; align-items: center;
      padding: 10px 12px; 
      background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(184, 155, 77, 0.05));
      border: 1px solid rgba(212, 175, 55, 0.25);
      border-radius: 10px;
    }
    .rew-lbl { font-family: 'Orbitron'; font-size: 8px; color: var(--treasure-gold); letter-spacing: 1px; }
    .rew-val { font-family: 'Share Tech Mono'; font-size: 15px; color: var(--treasure-gold); font-weight: 700; }
    .start-btn {
      width: 100%; margin-top: 12px; padding: 16px;
      background: linear-gradient(135deg, var(--bio-teal), var(--bio-cyan));
      border: none; color: var(--abyss);
      font-family: 'Orbitron'; font-size: 12px; font-weight: 700;
      letter-spacing: 2px; cursor: pointer;
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center; gap: 8px;
      transition: transform 0.2s, box-shadow 0.2s;
      min-height: 50px;
      box-shadow: 0 4px 20px rgba(42, 181, 160, 0.3);
    }
    .start-btn:active { transform: scale(0.98); }
    .start-btn:hover { transform: scale(1.02); box-shadow: 0 6px 25px rgba(42, 181, 160, 0.4); }
    .start-btn svg { width: 16px; height: 16px; fill: var(--abyss); }
    .start-btn.locked-btn {
      background: linear-gradient(135deg, rgba(30, 40, 50, 0.8), rgba(20, 30, 40, 0.8));
      color: rgba(224, 232, 240, 0.35);
      cursor: not-allowed;
      box-shadow: none;
    }
    .start-btn.locked-btn:hover { transform: none; box-shadow: none; }

    .bottom-nav {
      position: fixed; bottom: 0; left: 0; right: 0;
      max-width: 430px; margin: 0 auto; 
      height: calc(70px + var(--safe-bottom));
      padding-bottom: var(--safe-bottom);
      background: linear-gradient(180deg, rgba(6, 16, 24, 0.98), rgba(4, 8, 16, 0.99));
      border-top: 1px solid rgba(77, 216, 232, 0.1);
      display: flex; align-items: center; justify-content: space-around;
      z-index: 100;
    }
    .nav-item {
      display: flex; flex-direction: column; align-items: center; gap: 4px;
      padding: 12px 18px; cursor: pointer;
      min-width: 44px; min-height: 44px;
      transition: transform 0.2s;
    }
    .nav-item:active { transform: scale(0.95); }
    .nav-item svg { width: 22px; height: 22px; fill: rgba(224, 232, 240, 0.35); transition: fill 0.2s; }
    .nav-item span { font-size: 9px; color: rgba(224, 232, 240, 0.35); text-transform: uppercase; letter-spacing: 1px; transition: color 0.2s; }
    .nav-item.active svg { fill: var(--bio-cyan); filter: drop-shadow(0 0 8px rgba(77, 216, 232, 0.5)); }
    .nav-item.active span { color: var(--bio-cyan); }
  </style>
</head>
<body>
  <div class="bg-layer"></div>
  <div class="particles">
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
  </div>

  <header class="header">
    <div class="user-info">
      <div class="avatar"><div class="avatar-inner"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg></div></div>
      <div><div class="rank-text">LV.03</div><div class="rank-title">MINNOW</div></div>
    </div>
    <div class="currency">
      <div class="currency-item">SC <span id="coins">2,450</span></div>
      <div class="currency-item">ðŸ”¥ 7</div>
    </div>
  </header>

  <!-- HOME PAGE -->
  <div class="page home-page active" id="homePage">
    <div class="threat-card">
      <div class="threat-label">â–¸ ACTIVE THREAT</div>
      <div class="threat-title">CRYPTO RUG-PULL<br>SURVIVAL</div>
      <div class="threat-desc">Navigate a volatile token launch. Spot the warning signs before the founders disappear.</div>
      <div class="threat-meta">
        <div class="reward">+500 SC</div>
        <div class="diff-tag">HARD</div>
        <div class="time-tag"><svg viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg> 12 min</div>
      </div>
      <button class="cta-btn">ENTER SIMULATION <svg viewBox="0 0 24 24"><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/></svg></button>
    </div>

    <div class="section-label">COMBAT RADAR</div>
    <div class="radar-card radar-locked" id="radarCard">
      <div class="radar-lock-overlay">
        <div class="radar-lock-icon">ðŸ”’</div>
        <div class="radar-lock-title">CLASSIFIED</div>
        <div class="radar-lock-desc">Your threat profile is being analyzed...</div>
        <div class="radar-lock-level">Unlocks at <span>Level 5</span></div>
      </div>
      <div class="radar-wrap">
        <svg class="radar-svg" viewBox="0 0 200 200">
          <circle class="radar-ring" cx="100" cy="100" r="70" stroke-width="1"/>
          <circle class="radar-ring" cx="100" cy="100" r="50" stroke-width="1"/>
          <circle class="radar-ring" cx="100" cy="100" r="30" stroke-width="1"/>
          <polygon class="radar-shape" points="100,35 155,65 140,130 60,130 45,65"/>
          <circle class="radar-dot" cx="100" cy="35" r="5"/>
          <circle class="radar-dot" cx="155" cy="65" r="5"/>
          <circle class="radar-dot" cx="140" cy="130" r="5"/>
          <circle class="radar-dot" cx="60" cy="130" r="5"/>
          <circle class="radar-dot" cx="45" cy="65" r="5"/>
          <text class="radar-lbl" x="100" y="22" text-anchor="middle">DEF</text>
          <text class="radar-lbl" x="172" y="68">WL</text>
          <text class="radar-lbl" x="152" y="145">PUR</text>
          <text class="radar-lbl" x="48" y="145" text-anchor="end">INC</text>
          <text class="radar-lbl" x="28" y="68" text-anchor="end">SYS</text>
        </svg>
        <div class="radar-center"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg></div>
      </div>
      <div class="tap-hint">TAP TO ENTER PREDATOR GRID</div>
      <div class="skill-tags"><div class="skill-tag">Urgency Resistance II</div><div class="skill-tag">Index Fund Basics</div></div>
      <button class="outline-btn" id="skillTreeBtn">VIEW FULL SKILL TREE <svg viewBox="0 0 24 24"><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/></svg></button>
    </div>

    <div class="section-label">MISSION BOARD</div>
    <div class="mission-board">
      
      <!-- Daily Challenges -->
      <div class="board-section">
        <div class="board-header">
          <div class="board-title">DAILY CHALLENGES</div>
          <div class="board-timer"><svg viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>14:32:08</div>
        </div>
        
        <div class="challenge-card completed">
          <div class="challenge-check"></div>
          <div class="challenge-content">
            <div class="challenge-title">FOMO Flash Quiz</div>
            <div class="challenge-desc">Test your urgency resistance</div>
          </div>
          <div class="challenge-reward">
            <div class="reward-xp">+50SC</div>
            <div class="reward-type quiz">QUIZ</div>
          </div>
        </div>
        
        <div class="challenge-card">
          <div class="challenge-check"></div>
          <div class="challenge-content">
            <div class="challenge-title">Complete 1 Scenario</div>
            <div class="challenge-desc">Practice in any simulation</div>
          </div>
          <div class="challenge-reward">
            <div class="reward-xp">+100SC</div>
            <div class="reward-type scenario">SCENARIO</div>
          </div>
        </div>
        
        <div class="challenge-card">
          <div class="challenge-check"></div>
          <div class="challenge-content">
            <div class="challenge-title">Spot a Dark Pattern</div>
            <div class="challenge-desc">Find one in the wild, snap it</div>
          </div>
          <div class="challenge-reward">
            <div class="reward-xp">+75SC</div>
            <div class="reward-type real">REAL WORLD</div>
          </div>
        </div>
      </div>
      
      <!-- Weekly Challenge -->
      <div class="board-section">
        <div class="board-header">
          <div class="board-title">WEEKLY CHALLENGE</div>
          <div class="board-timer"><svg viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>4d 12h</div>
        </div>
        
        <div class="weekly-card">
          <div class="weekly-header">
            <div class="weekly-title">ðŸ¦ˆ Predator Hunter</div>
            <div class="weekly-reward">+500SC</div>
          </div>
          <div class="weekly-progress">
            <div class="weekly-progress-fill" style="width: 60%"></div>
          </div>
          <div class="weekly-status">Complete <span>15 scenarios</span> this week â€” 9/15 done</div>
        </div>
      </div>
      
    </div>
  </div>

  <!-- INTEL PAGE -->
  <div class="page intel-page" id="intelPage">
    <div class="intel-header">
      <button class="back-btn" id="backBtn"><svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>BACK</button>
      <div class="zoom-controls">
        <button class="zoom-btn" id="zoomOut">âˆ’</button>
        <span class="zoom-level" id="zoomLevel">100%</span>
        <button class="zoom-btn" id="zoomIn">+</button>
      </div>
      <button class="heat-btn" id="heatBtn"><svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/></svg>THREAT</button>
    </div>
    <div class="grid-area" id="gridArea">
      <div class="zoom-controls">
        <button class="zoom-btn" id="zoomIn">+</button>
        <div class="zoom-level" id="zoomLevel">100%</div>
        <button class="zoom-btn" id="zoomOut">âˆ’</button>
        <button class="zoom-btn" id="zoomReset" style="font-size:12px">â†º</button>
      </div>
      <div class="grid-scroll" id="gridScroll">
        <div class="zoom-container" id="zoomContainer">
        <div class="skill-map" id="skillMap">
          <div class="map-grid"></div>
          
          <!-- UNDERWATER BACKGROUND -->
          <div class="underwater-bg">
            <!-- Sunken ruins -->
            <div class="ruin ruin-1"></div>
            <div class="ruin ruin-2"></div>
            <div class="ruin ruin-3"></div>
            
            <!-- Coral formations -->
            <div class="coral coral-1"></div>
            <div class="coral coral-2"></div>
            <div class="coral coral-3"></div>
            
            <!-- Glowing plants -->
            <div class="glow-plant glow-plant-1"></div>
            <div class="glow-plant glow-plant-2"></div>
            <div class="glow-plant glow-plant-3"></div>
            
            <!-- Treasures -->
            <div class="treasure treasure-1">ðŸ’Ž</div>
            <div class="treasure treasure-2">ðŸº</div>
            <div class="treasure treasure-3">âš±ï¸</div>
            
            <!-- Caustic light -->
            <div class="caustics-overlay"></div>
          </div>
          
          <!-- RISING BUBBLES -->
          <div class="bubbles">
            <div class="bubble"></div>
            <div class="bubble"></div>
            <div class="bubble"></div>
            <div class="bubble"></div>
            <div class="bubble"></div>
            <div class="bubble"></div>
            <div class="bubble"></div>
            <div class="bubble"></div>
            <div class="bubble"></div>
            <div class="bubble"></div>
          </div>
          
          <!-- CONNECTION LINES -->
          <svg class="connection-lines" viewBox="0 0 800 900" preserveAspectRatio="none">
            <!-- Defense connections -->
            <path class="conn-line conn-def" d="M145,185 L225,225"/>
            <path class="conn-line conn-def" d="M225,225 L305,195"/>
            <path class="conn-line conn-def" d="M145,185 L175,285"/>
            <path class="conn-line conn-def" d="M225,225 L175,285"/>
            <path class="conn-line conn-def" d="M175,285 L265,295"/>
            <path class="conn-line conn-def" d="M265,295 L305,195"/>
            <!-- Defense pulse -->
            <path class="conn-line conn-pulse conn-def" d="M145,185 L225,225 L305,195"/>
            
            <!-- Wealth connections -->
            <path class="conn-line conn-wl" d="M655,185 L575,225"/>
            <path class="conn-line conn-wl" d="M575,225 L495,195"/>
            <path class="conn-line conn-wl" d="M655,185 L625,285"/>
            <path class="conn-line conn-wl" d="M575,225 L625,285"/>
            <path class="conn-line conn-wl" d="M625,285 L535,295"/>
            <path class="conn-line conn-wl" d="M535,295 L495,195"/>
            <!-- Wealth pulse -->
            <path class="conn-line conn-pulse conn-wl" d="M655,185 L575,225 L495,195"/>
            
            <!-- Income connections -->
            <path class="conn-line conn-inc" d="M125,635 L205,685"/>
            <path class="conn-line conn-inc" d="M205,685 L285,645"/>
            <path class="conn-line conn-inc" d="M125,635 L165,735"/>
            <path class="conn-line conn-inc" d="M205,685 L165,735"/>
            <!-- Income pulse -->
            <path class="conn-line conn-pulse conn-inc" d="M125,635 L205,685 L285,645"/>
            
            <!-- Purchase connections -->
            <path class="conn-line conn-pur" d="M675,635 L595,685"/>
            <path class="conn-line conn-pur" d="M595,685 L515,645"/>
            <path class="conn-line conn-pur" d="M675,635 L635,735"/>
            <path class="conn-line conn-pur" d="M595,685 L635,735"/>
            <!-- Purchase pulse -->
            <path class="conn-line conn-pulse conn-pur" d="M675,635 L595,685 L515,645"/>
            
            <!-- Systems connections (horizontal) -->
            <path class="conn-line conn-sys" d="M325,825 L395,825"/>
            <path class="conn-line conn-sys" d="M395,825 L465,825"/>
            <path class="conn-line conn-sys" d="M465,825 L535,825"/>
            <!-- Systems pulse -->
            <path class="conn-line conn-pulse conn-sys" d="M325,825 L395,825 L465,825 L535,825"/>
            
            <!-- Lines connecting to center -->
            <path class="conn-line" style="stroke:rgba(0,230,255,0.15)" d="M400,450 L265,295"/>
            <path class="conn-line" style="stroke:rgba(0,230,255,0.15)" d="M400,450 L535,295"/>
            <path class="conn-line" style="stroke:rgba(0,230,255,0.15)" d="M400,450 L165,685"/>
            <path class="conn-line" style="stroke:rgba(0,230,255,0.15)" d="M400,450 L635,685"/>
            <path class="conn-line" style="stroke:rgba(0,230,255,0.15)" d="M400,450 L400,780"/>
          </svg>
          
          <!-- CENTER EMBLEM - fixed position in map -->
          <div class="map-center">
            <div class="center-ring">
              <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
            </div>
          </div>

          <!-- TERRITORY LABELS & PROGRESS BARS -->
          <div class="terr-label lbl-def">DEFENSE</div>
          <div class="terr-bar bar-def"><div class="terr-fill"></div></div>
          
          <div class="terr-label lbl-wl">WEALTH</div>
          <div class="terr-bar bar-wl"><div class="terr-fill"></div></div>
          
          <div class="terr-label lbl-inc">INCOME</div>
          <div class="terr-bar bar-inc"><div class="terr-fill"></div></div>
          
          <div class="terr-label lbl-pur">PURCHASE</div>
          <div class="terr-bar bar-pur"><div class="terr-fill"></div></div>
          
          <div class="terr-label lbl-sys">SYSTEMS</div>
          <div class="terr-bar bar-sys"><div class="terr-fill"></div></div>

          <!-- DEFENSE NODES (top-left quadrant) -->
          <div class="snode mastered" style="top:160px;left:120px" data-s="scam"><div class="snode-shape">ðŸ›¡ï¸</div></div>
          <div class="snode mastered" style="top:200px;left:200px" data-s="phish"><div class="snode-shape">ðŸŽ£</div></div>
          <div class="snode unlocked" style="top:170px;left:280px" data-s="urgency"><div class="snode-shape">â°</div></div>
          <div class="snode recommended" style="top:260px;left:150px" data-s="fomo"><div class="snode-shape">ðŸ˜°</div></div>
          <div class="snode locked" style="top:270px;left:240px" data-s="pressure"><div class="snode-shape">ðŸ’ª</div></div>

          <!-- WEALTH NODES (top-right quadrant) -->
          <div class="snode mastered" style="top:160px;right:120px" data-s="compound"><div class="snode-shape">ðŸ“ˆ</div></div>
          <div class="snode unlocked" style="top:200px;right:200px" data-s="index"><div class="snode-shape">ðŸ“Š</div></div>
          <div class="snode unlocked" style="top:170px;right:280px" data-s="diverse"><div class="snode-shape">ðŸŽ¯</div></div>
          <div class="snode locked" style="top:260px;right:150px" data-s="crypto"><div class="snode-shape">â‚¿</div></div>
          <div class="snode locked" style="top:270px;right:240px" data-s="risk"><div class="snode-shape">âš–ï¸</div></div>

          <!-- INCOME NODES (bottom-left quadrant) -->
          <div class="snode mastered" style="top:610px;left:100px" data-s="paycheck"><div class="snode-shape">ðŸ’µ</div></div>
          <div class="snode unlocked" style="top:660px;left:180px" data-s="sidehustle"><div class="snode-shape">ðŸ’¼</div></div>
          <div class="snode locked" style="top:620px;left:260px" data-s="salary"><div class="snode-shape">ðŸ“Š</div></div>
          <div class="snode locked" style="top:710px;left:140px" data-s="passive"><div class="snode-shape">ðŸ”„</div></div>

          <!-- PURCHASE NODES (bottom-right quadrant) -->
          <div class="snode unlocked" style="top:610px;right:100px" data-s="negotiate"><div class="snode-shape">ðŸ¤</div></div>
          <div class="snode unlocked" style="top:660px;right:180px" data-s="car"><div class="snode-shape">ðŸš—</div></div>
          <div class="snode locked" style="top:620px;right:260px" data-s="house"><div class="snode-shape">ðŸ </div></div>
          <div class="snode locked" style="top:710px;right:140px" data-s="warranty"><div class="snode-shape">ðŸ“</div></div>

          <!-- SYSTEMS NODES (bottom center) -->
          <div class="snode unlocked" style="top:800px;left:300px" data-s="tax"><div class="snode-shape">ðŸ›ï¸</div></div>
          <div class="snode locked" style="top:800px;left:370px" data-s="credit"><div class="snode-shape">ðŸ“‹</div></div>
          <div class="snode locked" style="top:800px;left:440px" data-s="insurance"><div class="snode-shape">ðŸ”’</div></div>
          <div class="snode locked" style="top:800px;left:510px" data-s="legal"><div class="snode-shape">âš–ï¸</div></div>

        </div>
        </div><!-- /zoom-container -->
      </div>
    </div>

    <div class="detail-panel" id="detailPanel">
      <button class="panel-x" id="panelX"><svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button>
      <div class="detail-top">
        <div class="detail-icon" id="dIcon">ðŸ˜°</div>
        <div><div class="detail-name" id="dName">FOMO Defense</div><div class="detail-tier" id="dTier">TIER 2 â€¢ DEFENSE</div></div>
      </div>
      <div class="threat-box">
        <div class="threat-lbl">MANIPULATION TACTIC</div>
        <div class="threat-nm" id="dThreat">Fear of Missing Out</div>
        <div class="threat-qt" id="dQuote">"Everyone else is buying..."</div>
      </div>
      <div class="steps-box">
        <div class="steps-lbl">REQUIRED STEPS</div>
        <div class="step done"><div class="step-n">1</div><div><div class="step-t">Learn</div><div class="step-d">Discover how FOMO hijacks your brain.</div></div></div>
        <div class="step"><div class="step-n">2</div><div><div class="step-t">Practice</div><div class="step-d">Complete the simulation without panic.</div></div></div>
        <div class="step"><div class="step-n">3</div><div><div class="step-t">Prove</div><div class="step-d">Resist one FOMO purchase IRL.</div></div></div>
      </div>
      <div class="reward-box"><div class="rew-lbl">XP REWARD</div><div class="rew-val" id="dReward">+350 SC</div></div>
      <button class="start-btn" id="startBtn">BEGIN TRAINING <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></button>
    </div>
  </div>

  <nav class="bottom-nav">
    <div class="nav-item active" data-p="home"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg><span>Home</span></div>
    <div class="nav-item" data-p="pod"><svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg><span>Pod</span></div>
    <div class="nav-item" data-p="shop"><svg viewBox="0 0 24 24"><circle cx="12" cy="6" r="4" fill="currentColor"/><ellipse cx="12" cy="17" rx="7" ry="5" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="10" cy="5.5" r="0.8" fill="var(--abyss)"/><circle cx="14" cy="5.5" r="0.8" fill="var(--abyss)"/><path d="M10 7.5c1 1 3 1 4 0" fill="none" stroke="var(--abyss)" stroke-width="0.8"/></svg><span>Shop</span></div>
    <div class="nav-item" data-p="you"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3z"/></svg><span>You</span></div>
  </nav>

  <script>
    // Prevent pull-to-refresh on mobile
    document.body.addEventListener('touchmove', function(e) {
      if (e.target.closest('.grid-scroll, .home-page, .detail-panel')) return;
      e.preventDefault();
    }, { passive: false });

    // Prevent double-tap zoom
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function(e) {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) e.preventDefault();
      lastTouchEnd = now;
    }, false);

    const homePage = document.getElementById('homePage');
    const intelPage = document.getElementById('intelPage');
    const gridScroll = document.getElementById('gridScroll');
    const skillMap = document.getElementById('skillMap');
    const gridArea = document.getElementById('gridArea');
    const detailPanel = document.getElementById('detailPanel');
    const navItems = document.querySelectorAll('.nav-item');
    const zoomContainer = document.getElementById('zoomContainer');
    
    // Zoom state
    let currentZoom = 1;
    const minZoom = 0.4;
    const maxZoom = 1.5;
    const zoomStep = 0.15;
    
    function setZoom(newZoom, centerX, centerY) {
      const oldZoom = currentZoom;
      currentZoom = Math.max(minZoom, Math.min(maxZoom, newZoom));
      
      // Update transform
      zoomContainer.style.transform = `scale(${currentZoom})`;
      
      // Update zoom level display
      document.getElementById('zoomLevel').textContent = Math.round(currentZoom * 100) + '%';
      
      // Adjust scroll position to keep center point stable
      if (centerX !== undefined && centerY !== undefined) {
        const scrollLeft = gridScroll.scrollLeft;
        const scrollTop = gridScroll.scrollTop;
        const rect = gridScroll.getBoundingClientRect();
        
        // Calculate new scroll position
        const scaleChange = currentZoom / oldZoom;
        const newScrollLeft = (scrollLeft + centerX - rect.left) * scaleChange - (centerX - rect.left);
        const newScrollTop = (scrollTop + centerY - rect.top) * scaleChange - (centerY - rect.top);
        
        gridScroll.scrollLeft = newScrollLeft;
        gridScroll.scrollTop = newScrollTop;
      }
    }
    
    // Zoom control buttons
    document.getElementById('zoomIn').addEventListener('click', () => {
      const rect = gridScroll.getBoundingClientRect();
      setZoom(currentZoom + zoomStep, rect.left + rect.width/2, rect.top + rect.height/2);
    });
    
    document.getElementById('zoomOut').addEventListener('click', () => {
      const rect = gridScroll.getBoundingClientRect();
      setZoom(currentZoom - zoomStep, rect.left + rect.width/2, rect.top + rect.height/2);
    });
    
    document.getElementById('zoomReset').addEventListener('click', () => {
      setZoom(1);
      // Re-center on emblem
      setTimeout(() => {
        gridScroll.scrollLeft = 400 - gridScroll.clientWidth / 2;
        gridScroll.scrollTop = 450 - gridScroll.clientHeight / 2;
      }, 100);
    });
    
    // Pinch to zoom
    let initialPinchDistance = 0;
    let initialPinchZoom = 1;
    let pinchCenterX = 0;
    let pinchCenterY = 0;
    
    function getPinchDistance(touches) {
      const dx = touches[0].clientX - touches[1].clientX;
      const dy = touches[0].clientY - touches[1].clientY;
      return Math.sqrt(dx * dx + dy * dy);
    }
    
    function getPinchCenter(touches) {
      return {
        x: (touches[0].clientX + touches[1].clientX) / 2,
        y: (touches[0].clientY + touches[1].clientY) / 2
      };
    }
    
    gridScroll.addEventListener('touchstart', e => {
      if (e.touches.length === 2) {
        e.preventDefault();
        initialPinchDistance = getPinchDistance(e.touches);
        initialPinchZoom = currentZoom;
        const center = getPinchCenter(e.touches);
        pinchCenterX = center.x;
        pinchCenterY = center.y;
      }
    }, { passive: false });
    
    gridScroll.addEventListener('touchmove', e => {
      if (e.touches.length === 2) {
        e.preventDefault();
        const currentDistance = getPinchDistance(e.touches);
        const scale = currentDistance / initialPinchDistance;
        const newZoom = initialPinchZoom * scale;
        setZoom(newZoom, pinchCenterX, pinchCenterY);
      }
    }, { passive: false });
    
    // Mouse wheel zoom (for desktop testing)
    gridScroll.addEventListener('wheel', e => {
      if (e.ctrlKey || e.metaKey) {
        e.preventDefault();
        const delta = e.deltaY > 0 ? -zoomStep : zoomStep;
        setZoom(currentZoom + delta, e.clientX, e.clientY);
      }
    }, { passive: false });

    function showPage(page) {
      homePage.classList.remove('active');
      intelPage.classList.remove('active');
      navItems.forEach(n => n.classList.remove('active'));
      
      if (page === 'home') {
        homePage.classList.add('active');
        document.querySelector('[data-p="home"]').classList.add('active');
      } else if (page === 'intel') {
        intelPage.classList.add('active');
        // Don't highlight any nav item since intel isn't in nav anymore
        // Center the scroll on the map center (400, 450)
        setTimeout(() => {
          gridScroll.scrollLeft = 400 - (gridScroll.offsetWidth / 2);
          gridScroll.scrollTop = 450 - (gridScroll.offsetHeight / 2);
        }, 50);
      } else if (page === 'shop') {
        // For now, stay on home - shop page TBD
        homePage.classList.add('active');
        document.querySelector('[data-p="shop"]').classList.add('active');
      }
    }

    navItems.forEach(n => n.addEventListener('click', () => {
      const p = n.dataset.p;
      if (p === 'home' || p === 'shop') showPage(p);
    }));

    document.getElementById('radarCard').addEventListener('click', () => showPage('intel'));
    document.getElementById('skillTreeBtn').addEventListener('click', e => { e.stopPropagation(); showPage('intel'); });
    document.getElementById('backBtn').addEventListener('click', () => showPage('home'));

    document.getElementById('heatBtn').addEventListener('click', function() {
      this.classList.toggle('on');
      gridArea.classList.toggle('heatmap');
    });

    const skills = {
      scam: { i:'ðŸ›¡ï¸', n:'Scam Detection I', t:'TIER 1 â€¢ DEFENSE', th:'General Scams', q:'"Too good to be true..."', r:'+200' },
      phish: { i:'ðŸŽ£', n:'Phishing Defense', t:'TIER 1 â€¢ DEFENSE', th:'Identity Theft', q:'"Verify your account now!"', r:'+250' },
      urgency: { i:'â°', n:'Urgency Resistance II', t:'TIER 2 â€¢ DEFENSE', th:'Fake Urgency', q:'"Only 2 left in stock!"', r:'+300' },
      fomo: { i:'ðŸ˜°', n:'FOMO Defense', t:'TIER 2 â€¢ DEFENSE', th:'Fear of Missing Out', q:'"Everyone else is buying..."', r:'+350' },
      pressure: { i:'ðŸ’ª', n:'Pressure Immunity', t:'TIER 3 â€¢ DEFENSE', th:'High-Pressure Sales', q:'"I can only hold this for 10 min."', r:'+400' },
      compound: { i:'ðŸ“ˆ', n:'Compound Interest', t:'TIER 1 â€¢ WEALTH', th:'Financial Ignorance', q:'"Your money should work for you."', r:'+200' },
      index: { i:'ðŸ“Š', n:'Index Fund Basics', t:'TIER 2 â€¢ WEALTH', th:'Active Trading Traps', q:'"Beat the market with this tip!"', r:'+300' },
      diverse: { i:'ðŸŽ¯', n:'Diversification', t:'TIER 2 â€¢ WEALTH', th:'Concentration Risk', q:'"All eggs in one basket."', r:'+300' },
      crypto: { i:'â‚¿', n:'Crypto Literacy', t:'TIER 3 â€¢ WEALTH', th:'Crypto Scams', q:'"This coin will 100x!"', r:'+400' },
      risk: { i:'âš–ï¸', n:'Risk Assessment', t:'TIER 2 â€¢ WEALTH', th:'Blind Investing', q:'"Trust me, it\'s a sure thing."', r:'+300' },
      negotiate: { i:'ðŸ¤', n:'Negotiation 101', t:'TIER 1 â€¢ PURCHASE', th:'Overpaying', q:'"The price is the price."', r:'+250' },
      car: { i:'ðŸš—', n:'Car Dealer Tactics', t:'TIER 2 â€¢ PURCHASE', th:'Dealer Manipulation', q:'"Let me talk to my manager..."', r:'+350' },
      house: { i:'ðŸ ', n:'Home Buying', t:'TIER 3 â€¢ PURCHASE', th:'Real Estate Pressure', q:'"Multiple offers coming in!"', r:'+450' },
      warranty: { i:'ðŸ“', n:'Warranty Traps', t:'TIER 2 â€¢ PURCHASE', th:'Extended Warranty Scams', q:'"Your warranty is expiring!"', r:'+300' },
      paycheck: { i:'ðŸ’µ', n:'Paycheck Anatomy', t:'TIER 1 â€¢ INCOME', th:'Tax Confusion', q:'"Where did my money go?"', r:'+200' },
      sidehustle: { i:'ðŸ’¼', n:'Side Hustle Basics', t:'TIER 2 â€¢ INCOME', th:'MLM Traps', q:'"Be your own boss!"', r:'+300' },
      salary: { i:'ðŸ“Š', n:'Salary Negotiation', t:'TIER 2 â€¢ INCOME', th:'Undervaluing Yourself', q:'"We can\'t go any higher."', r:'+350' },
      passive: { i:'ðŸ”„', n:'Passive Income', t:'TIER 3 â€¢ INCOME', th:'Get Rich Quick', q:'"Make money while you sleep!"', r:'+400' },
      tax: { i:'ðŸ›ï¸', n:'Tax Fundamentals', t:'TIER 1 â€¢ SYSTEMS', th:'Tax Avoidance Scams', q:'"The IRS doesn\'t need to know..."', r:'+250' },
      credit: { i:'ðŸ“‹', n:'Credit Score', t:'TIER 1 â€¢ SYSTEMS', th:'Credit Repair Scams', q:'"We can fix your credit fast!"', r:'+250' },
      insurance: { i:'ðŸ”’', n:'Insurance Basics', t:'TIER 2 â€¢ SYSTEMS', th:'Insurance Fraud', q:'"You\'re underinsured!"', r:'+300' },
      legal: { i:'âš–ï¸', n:'Legal Protection', t:'TIER 2 â€¢ SYSTEMS', th:'Legal Scams', q:'"You\'ve been served!"', r:'+300' }
    };

    document.querySelectorAll('.snode').forEach(node => {
      node.addEventListener('click', () => {
        const s = skills[node.dataset.s];
        const isLocked = node.classList.contains('locked');
        const startBtn = document.getElementById('startBtn');
        
        if (s) {
          document.getElementById('dIcon').textContent = s.i;
          document.getElementById('dName').textContent = s.n;
          document.getElementById('dTier').textContent = s.t;
          document.getElementById('dThreat').textContent = s.th;
          document.getElementById('dQuote').textContent = s.q;
          document.getElementById('dReward').textContent = s.r + ' SC';
          
          if (isLocked) {
            startBtn.textContent = 'ðŸ”’ LOCKED';
            startBtn.classList.add('locked-btn');
          } else if (node.classList.contains('mastered')) {
            startBtn.innerHTML = 'REVIEW TRAINING <svg viewBox="0 0 24 24"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/></svg>';
            startBtn.classList.remove('locked-btn');
          } else {
            startBtn.innerHTML = 'BEGIN TRAINING <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>';
            startBtn.classList.remove('locked-btn');
          }
        }
        detailPanel.classList.add('open');
      });
    });

    document.getElementById('panelX').addEventListener('click', () => detailPanel.classList.remove('open'));
    gridArea.addEventListener('click', e => { if (!e.target.closest('.snode')) detailPanel.classList.remove('open'); });

    let dragging = false, sx, sy, sl, st;
    let dragStartTime = 0;
    let isPinching = false;
    
    gridScroll.addEventListener('mousedown', e => {
      if (e.target.closest('.snode')) return;
      dragging = true; gridScroll.style.cursor = 'grabbing';
      sx = e.pageX; sy = e.pageY;
      sl = gridScroll.scrollLeft; st = gridScroll.scrollTop;
    });
    document.addEventListener('mouseup', () => { dragging = false; gridScroll.style.cursor = 'grab'; });
    document.addEventListener('mousemove', e => {
      if (!dragging) return;
      gridScroll.scrollLeft = sl - (e.pageX - sx);
      gridScroll.scrollTop = st - (e.pageY - sy);
    });
    
    gridScroll.addEventListener('touchstart', e => {
      if (e.touches.length === 2) {
        isPinching = true;
        dragging = false;
        return;
      }
      if (e.target.closest('.snode')) return;
      dragging = true;
      isPinching = false;
      dragStartTime = Date.now();
      sx = e.touches[0].pageX; sy = e.touches[0].pageY;
      sl = gridScroll.scrollLeft; st = gridScroll.scrollTop;
    }, { passive: true });
    
    gridScroll.addEventListener('touchend', e => { 
      if (e.touches.length === 0) {
        dragging = false;
        isPinching = false;
      }
    }, { passive: true });
    
    gridScroll.addEventListener('touchmove', e => {
      if (isPinching || e.touches.length === 2) return;
      if (!dragging) return;
      const dx = e.touches[0].pageX - sx;
      const dy = e.touches[0].pageY - sy;
      gridScroll.scrollLeft = sl - dx;
      gridScroll.scrollTop = st - dy;
    }, { passive: true });
  </script>
</body>
</html>
